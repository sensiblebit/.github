name: PR Conventions

on:
  workflow_call:
    inputs:
      types:
        description: "Newline-separated list of valid Conventional Commit types"
        required: false
        type: string
        default: |
          feat
          fix
          docs
          style
          refactor
          perf
          test
          build
          ci
          chore
          revert

jobs:
  pr-title:
    name: PR Title
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: amannn/action-semantic-pull-request@v6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: ${{ inputs.types }}

  pr-conventions:
    name: PR Conventions
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - uses: actions/checkout@v6
        with:
          repository: sensiblebit/.github
          path: .sensiblebit-checks

      - name: Check branch name
        run: python3 .sensiblebit-checks/scripts/checks.py branch-name "${{ github.head_ref }}"

      - name: Check commit messages
        if: success() || failure()
        run: python3 .sensiblebit-checks/scripts/checks.py commit-message --ci --base-ref "origin/${{ github.base_ref }}"

      - name: Check commits are verified
        if: success() || failure()
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: python3 .sensiblebit-checks/scripts/checks.py verified-commits "${{ github.repository }}" "${{ github.event.pull_request.number }}"
